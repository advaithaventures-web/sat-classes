<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAT by Raj - Student Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a2332 0%, #2c3e50 100%);
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
        }

        .login-box h1 {
            color: #1a2332;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .login-box p {
            color: #666;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #B8860B;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #B8860B;
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: #9a7209;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-large {
            padding: 15px 30px;
            font-size: 16px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        /* Header */
        .header {
            background: #1a2332;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 20px;
            color: #B8860B;
        }

        .header-practice-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            justify-content: center;
        }

        .back-btn-header {
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
            font-size: 14px;
            padding: 0;
        }

        .back-btn-header:hover {
            color: white;
        }

        .header-topic {
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .header-mode {
            color: #aaa;
            font-size: 14px;
        }

        .header-divider {
            color: #555;
            font-size: 16px;
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-user span {
            color: #aaa;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }

        .page-title {
            margin-bottom: 30px;
        }

        .page-title h2 {
            color: #1a2332;
            font-size: 28px;
        }

        .page-title p {
            color: #666;
            margin-top: 5px;
        }

        /* Topics Grid */
        .topics-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .topic-row {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #eee;
            overflow: hidden;
        }

        .topic-main {
            display: flex;
            align-items: center;
            padding: 20px 25px;
            gap: 20px;
        }

        .topic-info {
            flex: 1;
        }

        .topic-info h3 {
            font-size: 16px;
            color: #1a2332;
            margin: 0;
        }

        .topic-info h3 .chapter-num {
            color: #666;
            font-weight: 600;
        }

        .topic-progress-mini {
            display: flex;
            gap: 15px;
            margin-top: 8px;
            font-size: 12px;
            color: #888;
        }

        .topic-progress-mini span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .progress-dot.complete {
            background: #28a745;
        }

        .progress-dot.partial {
            background: #ffc107;
        }

        .progress-dot.none {
            background: #ddd;
        }

        .topic-buttons {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .mode-btn {
            padding: 10px 24px;
            border: 2px solid;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s;
            min-width: 100px;
            text-align: center;
        }

        .mode-btn.untimed {
            border-color: #28a745;
            color: #28a745;
        }

        .mode-btn.untimed:hover {
            background: #28a745;
            color: white;
        }

        .mode-btn.timed {
            border-color: #dc3545;
            color: #dc3545;
        }

        .mode-btn.timed:hover {
            background: #dc3545;
            color: white;
        }

        .mode-btn .score-indicator {
            display: block;
            height: 3px;
            margin-top: 5px;
            border-radius: 2px;
            background: currentColor;
            width: 0%;
            transition: width 0.3s;
        }

        .expand-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            color: #999;
            font-size: 18px;
            transition: transform 0.3s;
        }

        .expand-btn.expanded {
            transform: rotate(180deg);
        }

        .expand-btn:hover {
            color: #333;
        }

        /* Expandable Content */
        .topic-expandable {
            display: none;
            padding: 0 25px 25px 25px;
            border-top: 1px solid #eee;
            background: #fafafa;
        }

        .topic-expandable.show {
            display: block;
        }

        .expandable-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            padding-top: 20px;
        }

        .video-section h4, .explanation-section h4 {
            color: #1a2332;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .video-placeholder {
            background: #1a2332;
            border-radius: 8px;
            aspect-ratio: 16/9;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
        }

        .video-placeholder span {
            color: #888;
        }

        .explanation-text {
            background: white;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            font-size: 14px;
            line-height: 1.6;
            color: #555;
            min-height: 120px;
        }

        @media (max-width: 768px) {
            .topic-main {
                flex-direction: column;
                align-items: flex-start;
            }

            .topic-buttons {
                width: 100%;
                justify-content: space-between;
            }

            .expandable-content {
                grid-template-columns: 1fr;
            }
        }

        /* Practice Page - Bluebook Style */
        .practice-container {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 30px;
            height: calc(100vh - 60px);
            flex-direction: column;
        }

        .practice-container.active {
            display: flex;
        }

        /* Timer in header */
        .timer {
            background: #fff3e0;
            color: #e65100;
            padding: 6px 14px;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            margin-left: 15px;
        }

        .timer.warning {
            background: #ffebee;
            color: #c62828;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Two Column Layout */
        .question-layout {
            display: flex;
            flex: 1;
            gap: 0;
            margin-top: 10px;
            min-height: 0;
            overflow: hidden;
        }

        .passage-panel {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: #fff;
        }

        .panel-divider {
            width: 2px;
            background: linear-gradient(to bottom, #ddd 0%, #ddd 50%, transparent 50%, transparent 100%);
            background-size: 2px 8px;
            margin: 0 5px;
        }

        .question-panel {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: #fff;
        }

        .passage {
            font-size: 16px;
            line-height: 1.8;
            color: #333;
            background: none;
            padding: 0;
            border: none;
            margin: 0;
        }

        .question-number {
            display: inline-block;
            background: #1a2332;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 0;
             margin-right: 12px;
    vertical-align: middle;
        }
.question-text {
    display: inline;
            font-size: 16px;
            color: #1a2332;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
        }

        .option {
            padding: 14px 18px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            background: white;
        }

        .option:hover {
            border-color: #1a2332;
            background: #f8f9fa;
        }

        .option.selected {
            border-color: #1a2332;
            background: #f0f4f8;
        }

        .option.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .option-letter {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 14px;
            flex-shrink: 0;
        }

        .option.selected .option-letter {
            background: #1a2332;
            border-color: #1a2332;
            color: white;
        }

        .option.correct .option-letter {
            background: #28a745;
            border-color: #28a745;
            color: white;
        }

        .option.incorrect .option-letter {
            background: #dc3545;
            border-color: #dc3545;
            color: white;
        }

        .explanation-box {
            background: #e8f4fd;
            border-left: 4px solid #2196f3;
            border-radius: 0 8px 8px 0;
            padding: 20px;
            margin-top: 25px;
            display: none;
        }

        .explanation-box h4 {
            color: #1565c0;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .explanation-box p {
            color: #333;
            line-height: 1.6;
            font-size: 14px;
        }

        /* Progress Bar */
        .question-progress {
            height: 6px;
            background: linear-gradient(to right, #B8860B 50%, #ddd 50%);
            border-radius: 3px;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .question-progress-bar {
            height: 100%;
            background: #B8860B;
            border-radius: 3px;
            transition: width 0.3s;
        }

        /* Bottom Navigation */
        .practice-nav-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid #eee;
            flex-shrink: 0;
        }

        .question-counter {
            background: #1a2332;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        /* Responsive for smaller screens */
        @media (max-width: 900px) {
            .question-layout {
                flex-direction: column;
            }

            .panel-divider {
                width: 100%;
                height: 2px;
                background: linear-gradient(to right, #ddd 0%, #ddd 50%, transparent 50%, transparent 100%);
                background-size: 8px 2px;
                margin: 10px 0;
            }

            .passage-panel, .question-panel {
                flex: none;
            }
        }

        .question-progress {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .question-progress-bar {
            background: #B8860B;
            height: 100%;
            transition: width 0.3s;
        }

        /* Results Page */
        .results-container {
            display: none;
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
        }

        .results-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 40px;
            text-align: center;
        }

        .results-score {
            font-size: 72px;
            font-weight: bold;
            color: #1a2332;
            margin: 20px 0;
        }

        .results-score span {
            font-size: 36px;
            color: #666;
        }

        .results-message {
            font-size: 24px;
            color: #666;
            margin-bottom: 30px;
        }

        .results-details {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 30px;
        }

        .results-stat {
            text-align: center;
        }

        .results-stat .number {
            font-size: 28px;
            font-weight: bold;
            color: #1a2332;
        }

        .results-stat .label {
            color: #666;
            font-size: 14px;
        }

        .review-section {
            text-align: left;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }

        .review-section h3 {
            margin-bottom: 20px;
            color: #1a2332;
        }

        .review-item {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .review-item.correct {
            background: #d4edda;
        }

        .review-item.incorrect {
            background: #f8d7da;
        }

        .review-item .question-preview {
            flex: 1;
            margin-right: 20px;
        }

        .review-item .answers {
            text-align: right;
        }

        /* Review Modal */
        .review-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .review-modal-overlay.active {
            display: flex;
        }

        .review-modal {
            background: white;
            border-radius: 10px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .review-modal-header {
            background: #1a2332;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .review-modal-header h3 {
            margin: 0;
        }

        .review-modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .review-modal-body {
            padding: 25px;
        }

        .review-result-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .review-result-badge.correct {
            background: #d4edda;
            color: #155724;
        }

        .review-result-badge.incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        .review-passage {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            line-height: 1.7;
            border-left: 4px solid #B8860B;
        }

        .review-question {
            font-size: 17px;
            color: #1a2332;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .review-options {
            margin-bottom: 20px;
        }

        .review-option {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .review-option.selected {
            border-color: #B8860B;
            background: #fdf8e8;
        }

        .review-option.correct-answer {
            border-color: #28a745;
            background: #d4edda;
        }

        .review-option.selected.wrong {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .review-option-letter {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            font-size: 14px;
        }

        .review-option.correct-answer .review-option-letter {
            background: #28a745;
            color: white;
        }

        .review-option.selected.wrong .review-option-letter {
            background: #dc3545;
            color: white;
        }

        .review-explanation {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
        }

        .review-explanation h4 {
            color: #1565c0;
            margin-bottom: 10px;
        }

        .review-explanation p {
            color: #333;
            line-height: 1.6;
        }

        .review-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            border-top: 1px solid #eee;
            background: #f8f9fa;
        }

        .review-nav button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            min-width: 100px;
        }

        .review-nav #reviewCounter {
            font-weight: 600;
            color: #1a2332;
            min-width: 60px;
            text-align: center;
        }

        .review-nav button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .review-item {
            cursor: pointer;
            transition: transform 0.2s;
        }

        .review-item:hover {
            transform: translateX(5px);
        }

        /* Dashboard visible state */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .results-container.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .topics-grid {
                grid-template-columns: 1fr;
            }

            .practice-header {
                flex-direction: column;
                gap: 15px;
            }

            .results-details {
                flex-direction: column;
                gap: 20px;
            }
        }

        .back-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 0;
        }

        .back-btn:hover {
            color: #1a2332;
        }

        /* Hide sections by default */
        #loginPage { display: flex; }
        #appContainer { display: none; }

        .forgot-link {
            text-align: center;
            margin-top: 15px;
        }

        .forgot-link a {
            color: #B8860B;
            text-decoration: none;
            font-size: 14px;
        }

        .forgot-link a:hover {
            text-decoration: underline;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .back-to-login {
            text-align: center;
            margin-top: 15px;
        }

        .back-to-login a {
            color: #666;
            text-decoration: none;
            font-size: 14px;
        }

        .back-to-login a:hover {
            color: #1a2332;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <!-- Login Form -->
        <div class="login-box" id="loginBox">
            <h1>üéì SAT by Raj</h1>
            <p>Student Portal - Login to Practice</p>
            <div class="error-message" id="loginError"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required placeholder="Enter your password">
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
            </form>
            <div class="forgot-link">
                <a href="#" onclick="showForgotPassword()">Forgot Password?</a>
            </div>
        </div>

        <!-- Forgot Password Form -->
        <div class="login-box" id="forgotBox" style="display: none;">
            <h1>üîë Reset Password</h1>
            <p>Enter your email to receive a reset code</p>
            <div class="error-message" id="forgotError"></div>
            <div class="success-message" id="forgotSuccess"></div>
            <form id="forgotForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="forgotEmail" required placeholder="Enter your email">
                </div>
                <button type="submit" class="btn btn-primary">Send Reset Code</button>
            </form>
            <div class="back-to-login">
                <a href="#" onclick="showLogin()">‚Üê Back to Login</a>
            </div>
        </div>

        <!-- Reset Password Form -->
        <div class="login-box" id="resetBox" style="display: none;">
            <h1>üîê New Password</h1>
            <p>Enter the reset code and your new password</p>
            <div class="error-message" id="resetError"></div>
            <div class="success-message" id="resetSuccess"></div>
            <form id="resetForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="resetEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label>Reset Code</label>
                    <input type="text" id="resetCode" required placeholder="6-digit code from instructor">
                </div>
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="newPassword" required placeholder="Enter new password" minlength="6">
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" id="confirmPassword" required placeholder="Confirm new password">
                </div>
                <button type="submit" class="btn btn-primary">Reset Password</button>
            </form>
            <div class="back-to-login">
                <a href="#" onclick="showLogin()">‚Üê Back to Login</a>
            </div>
        </div>
    </div>

    <!-- App Container -->
    <div id="appContainer">
        <!-- Header -->
        <header class="header">
            <h1>üéì SAT by Raj</h1>
            <!-- Practice Info (shown during practice) -->
            <div class="header-practice-info" id="headerPracticeInfo" style="display: none;">
                <button class="back-btn-header" onclick="exitPractice()">‚Üê Back to Topics</button>
                <span class="header-divider">|</span>
                <span class="header-topic" id="practiceTopicName"></span>
                <span class="header-divider">|</span>
                <span class="header-mode" id="practiceMode"></span>
                <div class="timer" id="timer" style="display: none;">00:00</div>
            </div>
            <div class="header-user">
                <span>Welcome, <strong id="userName"></strong></span>
                <button class="logout-btn" id="logoutBtn">Logout</button>
            </div>
        </header>

        <!-- Dashboard -->
        <div class="dashboard active" id="dashboard">
            <div class="main-content">
                <div class="page-title">
                    <h2>Practice Topics</h2>
                    <p>Select a topic to start practicing. Click the arrow to view lesson materials.</p>
                </div>
                <div class="topics-list" id="topicsGrid">
                    <!-- Topics will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Practice Page -->
        <div class="practice-container" id="practiceContainer">
            <div class="question-layout">
                <!-- Left Panel: Passage -->
                <div class="passage-panel">
                    <div class="passage" id="passage"></div>
                </div>
                
                <!-- Divider -->
                <div class="panel-divider"></div>
                
                <!-- Right Panel: Question & Options -->
                <div class="question-panel">
                    <div class="question-number" id="questionNumber"></div>
                    <div class="question-text" id="questionText"></div>
                    <div class="options" id="options"></div>
                    <div class="explanation-box" id="explanationBox">
                        <h4>üí° Explanation</h4>
                        <p id="explanationText"></p>
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="question-progress">
                <div class="question-progress-bar" id="progressBar"></div>
            </div>

            <!-- Bottom Navigation -->
            <div class="practice-nav-bottom">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()">‚Üê Previous</button>
                <div class="question-counter" id="questionCounter">Question 1 of 15</div>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Next ‚Üí</button>
                <button class="btn btn-success" id="submitBtn" onclick="submitPractice()" style="display:none;">Submit</button>
            </div>
        </div>

        <!-- Results Page -->
        <div class="results-container" id="resultsContainer">
            <div class="results-card">
                <h2>Practice Complete!</h2>
                <div class="results-score">
                    <span id="scoreNum">0</span><span>/15</span>
                </div>
                <div class="results-message" id="resultsMessage"></div>
                <div class="results-details">
                    <div class="results-stat">
                        <div class="number" id="correctCount">0</div>
                        <div class="label">Correct</div>
                    </div>
                    <div class="results-stat">
                        <div class="number" id="incorrectCount">0</div>
                        <div class="label">Incorrect</div>
                    </div>
                    <div class="results-stat">
                        <div class="number" id="timeSpent">-</div>
                        <div class="label">Time</div>
                    </div>
                </div>
                <button class="btn btn-primary btn-large" onclick="showDashboard()">Back to Topics</button>

                <div class="review-section">
                    <h3>Review Answers (Click to see details)</h3>
                    <div id="reviewList"></div>
                </div>
            </div>
        </div>

        <!-- Review Modal -->
        <div class="review-modal-overlay" id="reviewModalOverlay" onclick="closeReviewModal(event)">
            <div class="review-modal" onclick="event.stopPropagation()">
                <div class="review-modal-header">
                    <h3 id="reviewModalTitle">Question 1</h3>
                    <button class="review-modal-close" onclick="closeReviewModal()">&times;</button>
                </div>
                <div class="review-modal-body">
                    <div id="reviewResultBadge" class="review-result-badge"></div>
                    <div id="reviewPassage" class="review-passage"></div>
                    <div id="reviewQuestion" class="review-question"></div>
                    <div id="reviewOptions" class="review-options"></div>
                    <div id="reviewExplanation" class="review-explanation">
                        <h4>üí° Explanation</h4>
                        <p id="reviewExplanationText"></p>
                    </div>
                </div>
                <div class="review-nav">
                    <button class="btn btn-secondary" id="reviewPrevBtn" onclick="reviewPrevQuestion()">‚Üê Previous</button>
                    <span id="reviewCounter">1 / 15</span>
                    <button class="btn btn-primary" id="reviewNextBtn" onclick="reviewNextQuestion()">Next ‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://satbyraj-backend.onrender.com/api';
        let token = localStorage.getItem('studentToken');
        let currentUser = null;
        let topics = [];
        let currentAttempt = null;
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let answers = {};
        let timerInterval = null;
        let startTime = null;
        let isTimedMode = false;

        // Check if already logged in
        if (token) {
            checkAuth();
        }

        async function checkAuth() {
            try {
                const res = await fetch(`${API_URL}/auth/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (res.ok) {
                    const data = await res.json();
                    currentUser = data.user;
                    showApp();
                } else {
                    logout();
                }
            } catch (error) {
                logout();
            }
        }

        // Login form
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            try {
                const res = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();

                if (!res.ok) {
                    throw new Error(data.error || 'Login failed');
                }

                if (data.user.role === 'admin') {
                    throw new Error('Please use the admin panel for admin login');
                }

                localStorage.setItem('studentToken', data.token);
                token = data.token;
                currentUser = data.user;
                showApp();
            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
            }
        });

        // Forgot Password Form
        document.getElementById('forgotForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value;
            const errorDiv = document.getElementById('forgotError');
            const successDiv = document.getElementById('forgotSuccess');
            
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';

            try {
                const res = await fetch(`${API_URL}/auth/forgot-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });

                const data = await res.json();

                if (!res.ok) {
                    throw new Error(data.error || 'Request failed');
                }

                successDiv.textContent = 'Reset code generated! Please contact your instructor to get the code.';
                successDiv.style.display = 'block';
                
                // Pre-fill email in reset form
                document.getElementById('resetEmail').value = email;
                
                // Show reset form after 2 seconds
                setTimeout(() => {
                    showResetPassword();
                }, 2000);

            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
            }
        });

        // Reset Password Form
        document.getElementById('resetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('resetEmail').value;
            const code = document.getElementById('resetCode').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorDiv = document.getElementById('resetError');
            const successDiv = document.getElementById('resetSuccess');
            
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';

            if (newPassword !== confirmPassword) {
                errorDiv.textContent = 'Passwords do not match';
                errorDiv.style.display = 'block';
                return;
            }

            if (newPassword.length < 6) {
                errorDiv.textContent = 'Password must be at least 6 characters';
                errorDiv.style.display = 'block';
                return;
            }

            try {
                const res = await fetch(`${API_URL}/auth/reset-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, code, newPassword })
                });

                const data = await res.json();

                if (!res.ok) {
                    throw new Error(data.error || 'Reset failed');
                }

                successDiv.textContent = 'Password reset successful! Redirecting to login...';
                successDiv.style.display = 'block';
                
                // Redirect to login after 2 seconds
                setTimeout(() => {
                    showLogin();
                }, 2000);

            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
            }
        });

        // Navigation functions for forgot/reset password
        function showLogin() {
            document.getElementById('loginBox').style.display = 'block';
            document.getElementById('forgotBox').style.display = 'none';
            document.getElementById('resetBox').style.display = 'none';
            // Clear messages
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('forgotError').style.display = 'none';
            document.getElementById('forgotSuccess').style.display = 'none';
            document.getElementById('resetError').style.display = 'none';
            document.getElementById('resetSuccess').style.display = 'none';
        }

        function showForgotPassword() {
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('forgotBox').style.display = 'block';
            document.getElementById('resetBox').style.display = 'none';
        }

        function showResetPassword() {
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('forgotBox').style.display = 'none';
            document.getElementById('resetBox').style.display = 'block';
        }

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', logout);

        function logout() {
            localStorage.removeItem('studentToken');
            token = null;
            currentUser = null;
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
        }

        async function showApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('userName').textContent = currentUser.name;
            await loadTopics();
        }

        async function apiCall(endpoint, options = {}) {
            const res = await fetch(`${API_URL}${endpoint}`, {
                ...options,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`,
                    ...options.headers
                }
            });
            if (!res.ok) {
                const data = await res.json();
                throw new Error(data.error || 'API error');
            }
            return res.json();
        }

        async function loadTopics() {
            try {
                topics = await apiCall('/student/topics');
                renderTopics();
            } catch (error) {
                console.error('Failed to load topics:', error);
            }
        }

        function renderTopics() {
            const grid = document.getElementById('topicsGrid');
            grid.innerHTML = topics.map((t, index) => {
                // Determine progress indicators
                const untimedProgress = t.best_untimed_score ? (t.best_untimed_score >= 12 ? 'complete' : 'partial') : 'none';
                const timedProgress = t.best_timed_score ? (t.best_timed_score >= 12 ? 'complete' : 'partial') : 'none';
                const untimedWidth = t.best_untimed_score ? Math.round((t.best_untimed_score / 15) * 100) : 0;
                const timedWidth = t.best_timed_score ? Math.round((t.best_timed_score / 15) * 100) : 0;

                return `
                <div class="topic-row">
                    <div class="topic-main">
                        <div class="topic-info">
                            <h3><span class="chapter-num">Chapter ${index + 1} :</span> ${t.name}</h3>
                            <div class="topic-progress-mini">
                                <span><span class="progress-dot ${untimedProgress}"></span> Untimed: ${t.untimed_attempts || 0} attempts</span>
                                <span><span class="progress-dot ${timedProgress}"></span> Timed: ${t.timed_attempts || 0} attempts</span>
                            </div>
                        </div>
                        <div class="topic-buttons">
                            <button class="mode-btn untimed" onclick="startPractice(${t.id}, 'untimed', '${t.name.replace(/'/g, "\\'")}')">
                                Untimed
                                <span class="score-indicator" style="width: ${untimedWidth}%"></span>
                            </button>
                            <button class="mode-btn timed" onclick="startPractice(${t.id}, 'timed', '${t.name.replace(/'/g, "\\'")}')">
                                Timed
                                <span class="score-indicator" style="width: ${timedWidth}%"></span>
                            </button>
                            <button class="expand-btn" onclick="toggleExpand(${index}, this)">‚ñº</button>
                        </div>
                    </div>
                    <div class="topic-expandable" id="expand-${index}">
                        <div class="expandable-content">
                            <div class="video-section">
                                <h4>üìπ Recorded Lesson</h4>
                                <div class="video-placeholder">
                                    <span>Video coming soon</span>
                                </div>
                            </div>
                            <div class="explanation-section">
                                <h4>üìù Concept Explanation</h4>
                                <div class="explanation-text">
                                    ${t.description || 'Detailed explanation for this topic will be added soon. Check back later for comprehensive learning materials.'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function toggleExpand(index, btn) {
            const expandable = document.getElementById(`expand-${index}`);
            expandable.classList.toggle('show');
            btn.classList.toggle('expanded');
        }

        async function startPractice(topicId, setType, topicName) {
            try {
                // Load questions
                currentQuestions = await apiCall(`/student/topics/${topicId}/questions/${setType}`);
                
                if (currentQuestions.length === 0) {
                    alert('No questions available for this topic yet. Please check back later.');
                    return;
                }

                // Create attempt
                currentAttempt = await apiCall('/student/attempts', {
                    method: 'POST',
                    body: JSON.stringify({ topic_id: topicId, set_type: setType })
                });

                isTimedMode = setType === 'timed';
                currentQuestionIndex = 0;
                answers = {};
                startTime = Date.now();

                // Setup UI
                document.getElementById('practiceTopicName').textContent = topicName;
                document.getElementById('practiceMode').textContent = isTimedMode ? 'Timed Mode - 15 minutes' : 'Untimed Mode - Take your time';

                // Show/hide timer
                const timerEl = document.getElementById('timer');
                if (isTimedMode) {
                    timerEl.style.display = 'block';
                    startTimer(15 * 60); // 15 minutes
                } else {
                    timerEl.style.display = 'none';
                }

                showPractice();
                renderQuestion();
            } catch (error) {
                alert('Error starting practice: ' + error.message);
            }
        }

        function showDashboard() {
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('practiceContainer').classList.remove('active');
            document.getElementById('resultsContainer').classList.remove('active');
            document.getElementById('headerPracticeInfo').style.display = 'none';
            stopTimer();
            loadTopics(); // Refresh progress
        }

        function showPractice() {
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('practiceContainer').classList.add('active');
            document.getElementById('resultsContainer').classList.remove('active');
            document.getElementById('headerPracticeInfo').style.display = 'flex';
        }

        function showResults() {
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('practiceContainer').classList.remove('active');
            document.getElementById('resultsContainer').classList.add('active');
            document.getElementById('headerPracticeInfo').style.display = 'none';
            stopTimer();
        }

        function renderQuestion() {
            const q = currentQuestions[currentQuestionIndex];
            const total = currentQuestions.length;

            // Progress bar
            document.getElementById('progressBar').style.width = `${((currentQuestionIndex + 1) / total) * 100}%`;

            // Question number (just the number in circle)
            document.getElementById('questionNumber').textContent = currentQuestionIndex + 1;

            // Question counter at bottom
            document.getElementById('questionCounter').textContent = `Question ${currentQuestionIndex + 1} of ${total}`;

            // Passage
            const passageEl = document.getElementById('passage');
            const passagePanel = document.querySelector('.passage-panel');
            if (q.passage) {
                passageEl.textContent = q.passage;
                passagePanel.style.display = 'block';
                document.querySelector('.panel-divider').style.display = 'block';
            } else {
                passagePanel.style.display = 'none';
                document.querySelector('.panel-divider').style.display = 'none';
            }

            // Question text
            document.getElementById('questionText').textContent = q.question_text;

            // Options
            const optionsEl = document.getElementById('options');
            const options = [
                { letter: 'A', text: q.option_a },
                { letter: 'B', text: q.option_b },
                { letter: 'C', text: q.option_c },
                { letter: 'D', text: q.option_d }
            ];

            const savedAnswer = answers[q.id];
            const showResult = !isTimedMode && savedAnswer && savedAnswer.submitted;

            optionsEl.innerHTML = options.map(opt => {
                let classes = 'option';
                if (savedAnswer && savedAnswer.selected === opt.letter) {
                    classes += ' selected';
                    if (showResult) {
                        classes += savedAnswer.is_correct ? ' correct' : ' incorrect';
                    }
                }
                if (showResult && opt.letter === savedAnswer.correct_answer && !savedAnswer.is_correct) {
                    classes += ' correct';
                }
                return `
                    <div class="${classes}" onclick="selectOption('${opt.letter}')" ${showResult ? 'style="pointer-events:none;"' : ''}>
                        <span class="option-letter">${opt.letter}</span>
                        <span>${opt.text}</span>
                    </div>
                `;
            }).join('');

            // Explanation (for untimed mode after answering)
            const explanationBox = document.getElementById('explanationBox');
            if (showResult && savedAnswer.explanation) {
                document.getElementById('explanationText').textContent = savedAnswer.explanation;
                explanationBox.style.display = 'block';
            } else {
                explanationBox.style.display = 'none';
            }

            // Navigation buttons
            document.getElementById('prevBtn').style.visibility = currentQuestionIndex > 0 ? 'visible' : 'hidden';
            
            const isLastQuestion = currentQuestionIndex === total - 1;
            document.getElementById('nextBtn').style.display = isLastQuestion ? 'none' : 'inline-block';
            document.getElementById('submitBtn').style.display = isLastQuestion ? 'inline-block' : 'none';
        }

        async function selectOption(letter) {
            const q = currentQuestions[currentQuestionIndex];
            
            // If already answered in untimed mode, don't allow change
            if (!isTimedMode && answers[q.id] && answers[q.id].submitted) {
                return;
            }

            answers[q.id] = { selected: letter, submitted: false };

            if (!isTimedMode) {
                // Submit immediately in untimed mode
                try {
                    const result = await apiCall(`/student/attempts/${currentAttempt.id}/responses`, {
                        method: 'POST',
                        body: JSON.stringify({ question_id: q.id, selected_answer: letter })
                    });
                    answers[q.id] = {
                        selected: letter,
                        submitted: true,
                        is_correct: result.is_correct,
                        correct_answer: result.correct_answer,
                        explanation: result.explanation
                    };
                } catch (error) {
                    console.error('Failed to submit answer:', error);
                }
            }

            renderQuestion();
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        }

        async function submitPractice() {
            const unanswered = currentQuestions.filter(q => !answers[q.id] || !answers[q.id].selected);
            if (unanswered.length > 0 && !confirm(`You have ${unanswered.length} unanswered questions. Submit anyway?`)) {
                return;
            }

            stopTimer();
            const timeSpent = Math.floor((Date.now() - startTime) / 1000);

            try {
                let results;
                if (isTimedMode) {
                    // Submit all at once for timed mode
                    const responses = currentQuestions.map(q => ({
                        question_id: q.id,
                        selected_answer: answers[q.id]?.selected || null
                    }));

                    results = await apiCall(`/student/attempts/${currentAttempt.id}/submit-all`, {
                        method: 'POST',
                        body: JSON.stringify({ responses, time_taken_seconds: timeSpent })
                    });

                    // Store results for review
                    results.results.forEach(r => {
                        answers[r.question_id] = {
                            selected: r.selected_answer,
                            submitted: true,
                            is_correct: r.is_correct,
                            correct_answer: r.correct_answer,
                            explanation: r.explanation
                        };
                    });
                } else {
                    // Complete untimed attempt
                    await apiCall(`/student/attempts/${currentAttempt.id}/complete`, {
                        method: 'PUT'
                    });

                    // Calculate score from answers
                    const correct = Object.values(answers).filter(a => a.is_correct).length;
                    results = {
                        score: correct,
                        total: currentQuestions.length,
                        time_taken_seconds: timeSpent
                    };
                }

                showResultsPage(results, timeSpent);
            } catch (error) {
                alert('Error submitting practice: ' + error.message);
            }
        }

        function showResultsPage(results, timeSpent) {
            const score = results.score;
            const total = currentQuestions.length;
            const incorrect = total - score;

            document.getElementById('scoreNum').textContent = score;
            document.getElementById('correctCount').textContent = score;
            document.getElementById('incorrectCount').textContent = incorrect;

            const minutes = Math.floor(timeSpent / 60);
            const seconds = timeSpent % 60;
            document.getElementById('timeSpent').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            // Message based on score
            let message;
            const percentage = (score / total) * 100;
            if (percentage >= 90) message = "Excellent work! üåü";
            else if (percentage >= 70) message = "Good job! Keep practicing! üëç";
            else if (percentage >= 50) message = "Nice effort! Room for improvement. üìö";
            else message = "Keep practicing! You'll get better! üí™";
            document.getElementById('resultsMessage').textContent = message;

            // Review list
            const reviewList = document.getElementById('reviewList');
            reviewList.innerHTML = currentQuestions.map((q, i) => {
                const answer = answers[q.id] || {};
                const isCorrect = answer.is_correct;
                return `
                    <div class="review-item ${isCorrect ? 'correct' : 'incorrect'}" onclick="openReviewModal(${i})">
                        <div class="question-preview">
                            <strong>Q${i + 1}:</strong> ${q.question_text.substring(0, 60)}...
                        </div>
                        <div class="answers">
                            <span>Your answer: <strong>${answer.selected || '-'}</strong></span>
                            ${!isCorrect ? `<span> | Correct: <strong>${answer.correct_answer}</strong></span>` : ''}
                            <span style="margin-left: 10px; color: #666;">üëÅÔ∏è View</span>
                        </div>
                    </div>
                `;
            }).join('');

            showResults();
        }

        function exitPractice() {
            if (confirm('Are you sure you want to exit? Your progress will be lost.')) {
                showDashboard();
            }
        }

        // Timer functions
        function startTimer(seconds) {
            let remaining = seconds;
            updateTimerDisplay(remaining);

            timerInterval = setInterval(() => {
                remaining--;
                updateTimerDisplay(remaining);

                if (remaining <= 60) {
                    document.getElementById('timer').classList.add('warning');
                }

                if (remaining <= 0) {
                    stopTimer();
                    alert('Time is up! Submitting your answers...');
                    submitPractice();
                }
            }, 1000);
        }

        function updateTimerDisplay(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            document.getElementById('timer').textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // Review Modal Functions
        let currentReviewIndex = 0;

        function openReviewModal(index) {
            currentReviewIndex = index;
            renderReviewModal();
            document.getElementById('reviewModalOverlay').classList.add('active');
        }

        function closeReviewModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('reviewModalOverlay').classList.remove('active');
        }

        function renderReviewModal() {
            const q = currentQuestions[currentReviewIndex];
            const answer = answers[q.id] || {};
            const total = currentQuestions.length;

            // Title
            document.getElementById('reviewModalTitle').textContent = `Question ${currentReviewIndex + 1} of ${total}`;
            
            // Counter
            document.getElementById('reviewCounter').textContent = `${currentReviewIndex + 1} / ${total}`;

            // Result badge
            const badgeEl = document.getElementById('reviewResultBadge');
            if (answer.is_correct) {
                badgeEl.className = 'review-result-badge correct';
                badgeEl.textContent = '‚úì Correct';
            } else {
                badgeEl.className = 'review-result-badge incorrect';
                badgeEl.textContent = '‚úó Incorrect';
            }

            // Passage
            const passageEl = document.getElementById('reviewPassage');
            if (q.passage) {
                passageEl.style.display = 'block';
                passageEl.textContent = q.passage;
            } else {
                passageEl.style.display = 'none';
            }

            // Question
            document.getElementById('reviewQuestion').textContent = q.question_text;

            // Options
            const options = [
                { letter: 'A', text: q.option_a },
                { letter: 'B', text: q.option_b },
                { letter: 'C', text: q.option_c },
                { letter: 'D', text: q.option_d }
            ];

            const optionsEl = document.getElementById('reviewOptions');
            optionsEl.innerHTML = options.map(opt => {
                let classes = 'review-option';
                const isSelected = answer.selected === opt.letter;
                const isCorrectAnswer = answer.correct_answer === opt.letter;
                
                if (isCorrectAnswer) {
                    classes += ' correct-answer';
                }
                if (isSelected && !answer.is_correct) {
                    classes += ' selected wrong';
                } else if (isSelected && answer.is_correct) {
                    classes += ' correct-answer';
                }

                return `
                    <div class="${classes}">
                        <span class="review-option-letter">${opt.letter}</span>
                        <span>${opt.text}</span>
                        ${isSelected ? '<span style="margin-left: auto; font-weight: 500;">(Your answer)</span>' : ''}
                        ${isCorrectAnswer && !isSelected ? '<span style="margin-left: auto; font-weight: 500; color: #28a745;">(Correct answer)</span>' : ''}
                    </div>
                `;
            }).join('');

            // Explanation
            const explanationEl = document.getElementById('reviewExplanation');
            const explanationText = answer.explanation || 'No explanation available for this question.';
            document.getElementById('reviewExplanationText').textContent = explanationText;
            explanationEl.style.display = 'block';

            // Navigation buttons
            document.getElementById('reviewPrevBtn').disabled = currentReviewIndex === 0;
            document.getElementById('reviewNextBtn').disabled = currentReviewIndex === total - 1;
        }

        function reviewPrevQuestion() {
            if (currentReviewIndex > 0) {
                currentReviewIndex--;
                renderReviewModal();
            }
        }

        function reviewNextQuestion() {
            if (currentReviewIndex < currentQuestions.length - 1) {
                currentReviewIndex++;
                renderReviewModal();
            }
        }

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeReviewModal();
            }
            if (document.getElementById('reviewModalOverlay').classList.contains('active')) {
                if (e.key === 'ArrowLeft') reviewPrevQuestion();
                if (e.key === 'ArrowRight') reviewNextQuestion();
            }
        });
    </script>
</body>
</html>
